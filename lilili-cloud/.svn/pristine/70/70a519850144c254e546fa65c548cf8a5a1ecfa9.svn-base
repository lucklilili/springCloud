package com.bwcloud.billingCenter.rubricInfoTable.downloadService.impl;


import com.alibaba.fastjson.JSONObject;
import com.bwcloud.billingCenter.rubricInfoTable.downloadService.DownloadService;
import com.bwcloud.billingCenter.utlis.UniversalUtils;

/**
 * 红字信息表下载实现类
 * Created by bs on 2018/4/10.
 */
public class DownloadServiceImpl implements DownloadService {
    /**
     * 通过红字信息表下载接口下载开具红票时需要的红字信息表编号
     *
     * @param string
     * @return
     */
    @Override
    public String rubricInfoTableDownload(String string) {
        String xml = rubricInfoTableDownload2Xml(string);
        String receiveXml = sendXml(xml);
        String sendJson = xml2Json(receiveXml);
        return sendJson;
    }
    /**
     * 通过红字信息表下载接口下载开具红票时需要的红字信息表编号
     *  json 转 xml
     * @param string
     * @return
     */
    public String rubricInfoTableDownload2Xml(String string) {
        try{
            JSONObject json = JSONObject.parseObject(string);
            JSONObject business = json.getJSONObject("business");
            String id = business.getString("id");
            String comment = business.getString("comment");
            JSONObject body = business.getJSONObject("body");
            String yylxdm = body.getString("yylxdm");
            String kpzdbs = body.getString("kpzdbs");
            String fplxdm = body.getString("fplxdm");
            String yqzt = body.getString("yqzt");
            String tkrq_q = body.getString("tkrq_q");
            String tkrq_z = body.getString("tkrq_z");
            String gfsh = body.getString("gfsh");
            String xfsh = body.getString("xfsh");
            String xxbbh = body.getString("xxbbh");
            String xxbfw = body.getString("xxbfw");
            String yh = body.getString("yh");
            String ys = body.getString("ys");

            StringBuffer stringBuffer = new StringBuffer();
            stringBuffer.append("<?xml version=\"1.0\" encoding=\"gbk\"?>\n");
            stringBuffer.append("<business id=\"");
            stringBuffer.append(id);
            stringBuffer.append("\" comment=\"");
            stringBuffer.append(comment);
            stringBuffer.append("\">\n\t<body yylxdm=\"");
            stringBuffer.append(yylxdm);
            stringBuffer.append("\">\n\t\t<kpzdbs>");
            stringBuffer.append(kpzdbs);
            stringBuffer.append("</kpzdbs>");
            stringBuffer.append("\n\t\t<fplxdm>");
            stringBuffer.append(fplxdm);
            stringBuffer.append("</fplxdm>");

            stringBuffer.append("\n\t\t<yqzt>");
            stringBuffer.append(yqzt);
            stringBuffer.append("</yqzt>");
            stringBuffer.append("\n\t\t<tkrq_q>");
            stringBuffer.append(tkrq_q);
            stringBuffer.append("</tkrq_q>");
            stringBuffer.append("\n\t\t<tkrq_z>");
            stringBuffer.append(tkrq_z);
            stringBuffer.append("</tkrq_z>");
            stringBuffer.append("\n\t\t<gfsh>");
            stringBuffer.append(gfsh);
            stringBuffer.append("</gfsh>");
            stringBuffer.append("\n\t\t<xfsh>");
            stringBuffer.append(xfsh);
            stringBuffer.append("</xfsh>");
            stringBuffer.append("\n\t\t<xxbbh>");
            stringBuffer.append(xxbbh);
            stringBuffer.append("</xxbbh>");
            stringBuffer.append("\n\t\t<xxbfw>");
            stringBuffer.append(xxbfw);
            stringBuffer.append("</xxbfw>");
            stringBuffer.append("\n\t\t<yh>");
            stringBuffer.append(yh);
            stringBuffer.append("</yh>");
            stringBuffer.append("\n\t\t<ys>");
            stringBuffer.append(ys);
            stringBuffer.append("</ys>");
            stringBuffer.append("\n\t</body>");
            stringBuffer.append("\n</business>");
            return stringBuffer.toString();
        }catch(Exception e){
            return "json转xml，转换失败！";
        }
    }
    String sendXml(String string){
        return "";
    }

    /**
     * 通过红字信息表下载接口下载开具红票时需要的红字信息表编号
     *  xml 转 json
     * @param receiveXml
     * @return
     */
    String xml2Json(String receiveXml){
        try {
            String sendJson = UniversalUtils.xmlToJson(receiveXml);
            return sendJson;
        }catch (Exception e){
            return "税控服务器发送xml，解析失败！";
        }
    }
}
